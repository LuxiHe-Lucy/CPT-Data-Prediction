"""
RF 模型封装：RandomForestRegressor
"""
from __future__ import annotations

from typing import Any, Dict, Optional

import numpy as np
from sklearn.ensemble import RandomForestRegressor


class RFModel:
    """随机森林回归核心封装"""

    def __init__(self, config: Optional[Dict[str, Any]] = None) -> None:
        config = config or {}
        self.model = RandomForestRegressor(
            n_estimators=config.get("n_estimators", 100),
            criterion=config.get("criterion", "squared_error"),
            max_depth=config.get("max_depth", None),
            min_samples_split=config.get("min_samples_split", 2),
            min_samples_leaf=config.get("min_samples_leaf", 1),
            max_features=config.get("max_features", "sqrt"),
            bootstrap=config.get("bootstrap", True),
            n_jobs=config.get("n_jobs", -1),
            random_state=config.get("random_state", 42),
        )

    def fit(self, X: np.ndarray, y: np.ndarray) -> "RFModel":
        y = y.flatten() if y.ndim > 1 else y
        self.model.fit(X, y)
        return self

    def predict(self, X: np.ndarray) -> np.ndarray:
        pred = self.model.predict(X)
        return pred.flatten() if pred.ndim > 1 else pred
